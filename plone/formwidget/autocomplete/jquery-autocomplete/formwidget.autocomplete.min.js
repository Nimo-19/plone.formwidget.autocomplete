function formwidget_autocomplete_ready(e,t,a){formwidget_autocomplete_new_value(jQuery(e.target),t[0],t[1])}function formwidget_autocomplete_new_value(e,t,a){!function(n){var i=e[0].id.replace(/-widgets-query$/,""),r=e[0].name.replace(/\.widgets\.query$/,""),l=n("#"+i+"-input-fields"),o=l.find("input:radio, input:checkbox");e.val(""),l.find("input:radio").prop("checked",!1);var u=l.find('input[value="'+t+'"]');if(u.length)u.each((function(){this.checked=!0}));else{var s=o.length,c=l.data("klass"),f=l.data("title"),h=l.data("input_type"),p=l.data("multiple"),d=n("<span/>").attr("id",i+"-"+s+"-wrapper").attr("class","option");d.append(n("<label/>").attr("for",i+"-"+s).append(n('<input type="'+h+'" name="'+r+(p?':list"':'"')+' checked="checked" />').attr("id",i+"-"+s).attr("title",f).attr("value",t).addClass(c)).append(" ").append(n("<span>").attr("class","label").text(a))),l.append(d)}}(jQuery)}function formwidget_autocomplete_parser(e,t){return function(a){var n=[];if(void 0!==a&&a.split)for(var i=a.split("\n"),r=0;r<i.length;r++){var l=$.trim(i[r]);l&&(l=l.split("|"),n[n.length]={data:l,value:l[t],result:e(l,l[t])})}return n}}!function(e){e.fn.extend({autocomplete:function(t,a){var n="string"==typeof t;return(a=e.extend({},e.Autocompleter.defaults,{url:n?t:null,data:n?null:t,delay:n?e.Autocompleter.defaults.delay:10,max:a&&!a.scroll?10:150},a)).highlight=a.highlight||function(e){return e},a.formatMatch=a.formatMatch||a.formatItem,this.each((function(){new e.Autocompleter(this,a)}))},result:function(e){return this.bind("result",e)},search:function(e){return this.trigger("search",[e])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(e){return this.trigger("setOptions",[e])},unautocomplete:function(){return this.trigger("unautocomplete")}}),e.Autocompleter=function(t,a){function n(){var e=y.selected();if(!e)return!1;var t=e.result;if(C=t,a.multiple){var n=r(v.val());n.length>1&&(t=n.slice(0,n.length-1).join(a.multipleSeparator)+a.multipleSeparator+t),t+=a.multipleSeparator}return v.val(t),u(),v.trigger("result",[e.data,e.value]),!0}function i(e,t){if(d!=g.DEL){var n=v.val();(t||n!=C)&&(C=n,(n=l(n)).length>=a.minChars?(v.addClass(a.loadingClass),a.matchCase||(n=n.toLowerCase()),c(n,s,u)):(h(),y.hide()))}else y.hide()}function r(t){if(!t)return[""];var n=t.split(a.multipleSeparator),i=[];return e.each(n,(function(t,a){e.trim(a)&&(i[t]=e.trim(a))})),i}function l(e){if(!a.multiple)return e;var t=r(e);return t[t.length-1]}function o(n,i){a.autoFill&&l(v.val()).toLowerCase()==n.toLowerCase()&&d!=g.BACKSPACE&&(v.val(v.val()+i.substring(l(C).length)),e.Autocompleter.Selection(t,C.length,C.length+i.length))}function u(){var n=y.visible();y.hide(),clearTimeout(p),h(),a.mustMatch&&v.search((function(e){if(!e)if(a.multiple){var t=r(v.val()).slice(0,-1);v.val(t.join(a.multipleSeparator)+(t.length?a.multipleSeparator:""))}else v.val("")})),n&&e.Autocompleter.Selection(t,t.value.length,t.value.length)}function s(e,t){t&&t.length&&b?(h(),y.display(t,e),o(e,t[0].value),y.show()):u()}function c(n,i,r){a.matchCase||(n=n.toLowerCase());var o=w.load(n);if(o&&o.length)i(n,o);else if("string"==typeof a.url&&a.url.length>0){var u={timestamp:+new Date};e.each(a.extraParams,(function(e,t){u[e]="function"==typeof t?t():t})),e.ajax({mode:"abort",port:"autocomplete"+t.name,dataType:a.dataType,url:a.url,data:e.extend({q:l(n),limit:a.max},u),success:function(e){var t=a.parse&&a.parse(e)||f(e);w.add(n,t),i(n,t)}})}else y.emptyList(),r(n)}function f(t){for(var n=[],i=t.split("\n"),r=0;r<i.length;r++){var l=e.trim(i[r]);l&&(l=l.split("|"),n[n.length]={data:l,value:l[0],result:a.formatResult&&a.formatResult(l,l[0])||l[0]})}return n}function h(){v.removeClass(a.loadingClass)}var p,d,m,g={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},v=e(t).attr("autocomplete","off").addClass(a.inputClass),C="",w=e.Autocompleter.Cache(a),b=0,A={mouseDownOnSelect:!1},y=e.Autocompleter.Select(a,t,n,A),T=-1!=navigator.userAgent.indexOf("Opera");T&&e(t.form).bind("submit.autocomplete",(function(){if(m)return m=!1,!1})),v.bind((T?"keypress":"keydown")+".autocomplete",(function(t){switch(d=t.keyCode,t.keyCode){case g.UP:t.preventDefault(),y.visible()?y.prev():i(0,!0);break;case g.DOWN:t.preventDefault(),y.visible()?y.next():i(0,!0);break;case g.PAGEUP:t.preventDefault(),y.visible()?y.pageUp():i(0,!0);break;case g.PAGEDOWN:t.preventDefault(),y.visible()?y.pageDown():i(0,!0);break;case a.multiple&&","==e.trim(a.multipleSeparator)&&g.COMMA:case g.TAB:case g.RETURN:if(n())return t.preventDefault(),m=!0,!1;break;case g.ESC:y.hide();break;default:clearTimeout(p),p=setTimeout(i,a.delay)}})).focus((function(){b++})).blur((function(){b=0,A.mouseDownOnSelect||(clearTimeout(p),p=setTimeout(u,200))})).click((function(){b++>1&&!y.visible()&&i(0,!0)})).bind("search",(function(){function t(e,t){var n;if(t&&t.length)for(var i=0;i<t.length;i++)if(t[i].result.toLowerCase()==e.toLowerCase()){n=t[i];break}"function"==typeof a?a(n):v.trigger("result",n&&[n.data,n.value])}var a=arguments.length>1?arguments[1]:null;e.each(r(v.val()),(function(e,a){c(a,t,t)}))})).bind("flushCache",(function(){w.flush()})).bind("setOptions",(function(){e.extend(a,arguments[1]),"data"in arguments[1]&&w.populate()})).bind("unautocomplete",(function(){y.unbind(),v.unbind(),e(t.form).unbind(".autocomplete")}))},e.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:!1,matchSubset:!0,matchContains:!1,cacheLength:10,max:100,mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(e){return e[0]},formatMatch:null,autoFill:!1,width:0,multiple:!1,multipleSeparator:", ",highlight:function(e,t){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:!0,scrollHeight:180},e.Autocompleter.Cache=function(t){function a(e,a){t.matchCase||(e=e.toLowerCase());var n=e.indexOf(a);return-1!=n&&(0==n||t.matchContains)}function n(e,a){o>t.cacheLength&&r(),l[e]||o++,l[e]=a}function i(){if(!t.data)return!1;var a={},i=0;t.url||(t.cacheLength=1),a[""]=[];for(var r=0,l=t.data.length;r<l;r++){var o=t.data[r];o="string"==typeof o?[o]:o;var u=t.formatMatch(o,r+1,t.data.length);if(!1!==u){var s=u.charAt(0).toLowerCase();a[s]||(a[s]=[]);var c={value:u,data:o,result:t.formatResult&&t.formatResult(o)||u};a[s].push(c),i++<t.max&&a[""].push(c)}}e.each(a,(function(e,a){t.cacheLength++,n(e,a)}))}function r(){l={},o=0}var l={},o=0;return setTimeout(i,25),{flush:r,add:n,populate:i,load:function(n){if(!t.cacheLength||!o)return null;if(!t.url&&t.matchContains){var i=[];for(var r in l)if(r.length>0){var u=l[r];e.each(u,(function(e,t){a(t.value,n)&&i.push(t)}))}return i}if(l[n])return l[n];if(t.matchSubset)for(var s=n.length-1;s>=t.minChars;s--){if(u=l[n.substr(0,s)]){i=[];return e.each(u,(function(e,t){a(t.value,n)&&(i[i.length]=t)})),i}}return null}}},e.Autocompleter.Select=function(t,a,n,i){function r(){g&&(f=e("<div/>").hide().addClass(t.resultsClass).css("position","absolute").appendTo(document.body),h=e("<ul/>").appendTo(f).mouseover((function(t){l(t).nodeName&&"LI"==l(t).nodeName.toUpperCase()&&(d=e("li",h).removeClass(p.ACTIVE).index(l(t)),e(l(t)).addClass(p.ACTIVE))})).click((function(t){return e(l(t)).addClass(p.ACTIVE),n(),a.focus(),!1})).mousedown((function(){i.mouseDownOnSelect=!0})).mouseup((function(){i.mouseDownOnSelect=!1})),t.width>0&&f.css("width",t.width),g=!1)}function l(e){for(var t=e.target;t&&"LI"!=t.tagName;)t=t.parentNode;return t||[]}function o(e){s.slice(d,d+1).removeClass(p.ACTIVE),function(e){d+=e,d<0?d=s.size()-1:d>=s.size()&&(d=0)}(e);var a=s.slice(d,d+1).addClass(p.ACTIVE);if(t.scroll){var n=0;s.slice(0,d).each((function(){n+=this.offsetHeight})),n+a[0].offsetHeight-h.scrollTop()>h[0].clientHeight?h.scrollTop(n+a[0].offsetHeight-h.innerHeight()):n<h.scrollTop()&&h.scrollTop(n)}}function u(){h.empty();for(var a=function(e){return t.max&&t.max<e?t.max:e}(c.length),n=0;n<a;n++)if(c[n]){var i=t.formatItem(c[n].data,n+1,a,c[n].value,m);if(!1!==i){var r=e("<li/>").html(t.highlight(i,m)).addClass(n%2==0?"ac_even":"ac_odd").appendTo(h)[0];e.data(r,"ac_data",c[n])}}s=h.find("li"),t.selectFirst&&(s.slice(0,1).addClass(p.ACTIVE),d=0),e.fn.bgiframe&&h.bgiframe()}var s,c,f,h,p={ACTIVE:"ac_over"},d=-1,m="",g=!0;return{display:function(e,t){r(),c=e,m=t,u()},next:function(){o(1)},prev:function(){o(-1)},pageUp:function(){o(0!=d&&d-8<0?-d:-8)},pageDown:function(){d!=s.size()-1&&d+8>s.size()?o(s.size()-1-d):o(8)},hide:function(){f&&f.hide(),s&&s.removeClass(p.ACTIVE),d=-1},visible:function(){return f&&f.is(":visible")},current:function(){return this.visible()&&(s.filter("."+p.ACTIVE)[0]||t.selectFirst&&s[0])},show:function(){var n=e(a).offset();if(f.css({width:"string"==typeof t.width||t.width>0?t.width:e(a).width(),top:n.top+a.offsetHeight,left:n.left}).show(),t.scroll&&(h.scrollTop(0),h.css({maxHeight:t.scrollHeight,overflow:"auto"}),1!=navigator.userAgent.indexOf("MSIE")&&void 0===document.body.style.maxHeight)){var i=0;s.each((function(){i+=this.offsetHeight}));var r=i>t.scrollHeight;h.css("height",r?t.scrollHeight:i),r||s.width(h.width()-parseInt(s.css("padding-left"))-parseInt(s.css("padding-right")))}},selected:function(){var t=s&&s.filter("."+p.ACTIVE).removeClass(p.ACTIVE);return t&&t.length&&e.data(t[0],"ac_data")},emptyList:function(){h&&h.empty()},unbind:function(){f&&f.remove()}}},e.Autocompleter.Selection=function(e,t,a){if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveStart("character",t),n.moveEnd("character",a),n.select()}else e.setSelectionRange?e.setSelectionRange(t,a):e.selectionStart&&(e.selectionStart=t,e.selectionEnd=a);e.focus()}}(jQuery);